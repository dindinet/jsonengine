<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>BBS sample by jsonengine</title>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.1/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">

$(function() {
  query();
});

// post a message
function post(msg) {
  disableButton(true);
  $("#msgTxt").val("");
  $.post("/_je/msg", { msg: msg }, function (result){	
    query();
  }, "text");
}

// get all posts and show it
function query() {
  disableButton(true);
  $.get("/_je/msg", { sort: "_createdAt.desc" }, function (result) {
    $("#messages").empty();
    for (i = 0; i < result.length; i++) {
      $("#messages").append("<br>(" + getUserName(result[i]) + ") " + result[i].msg);        
    }
    disableButton(false);
  });
}

// extract an user name from the creator's email address
function getUserName(doc) {
  return doc._createdBy == null ? "nobody" : doc._createdBy.split("@")[0]; 
}

// disable sendBtn while waiting for reply from server
function disableButton(isDisabled) {
  if (isDisabled) {
    $("#sendBtn").attr("disabled", true);
  } else {
    $("#sendBtn").removeAttr("disabled");
  }
}

</script>
</head>

<body>
<h1>BBS sample by jsonengine</h1>
<input id="msgTxt" type="text" value=""  size="50">
<input id="sendBtn" type="button" value="Send" onclick="post($('#msgTxt').val());" ><br>
<span id="messages"></span><br>
<br>
<hr>
<center>
Please see the HTML source of this page to learn how to write jQuery client for jsonengine.<br>
Powered by <a href="http://code.google.com/p/jsonengine/">jsonengine</a><br>
</center>
</body>

</html>